!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Textoverlay=t():e.Textoverlay=t()}(window,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();var o={backdrop:{"box-sizing":"border-box",position:"absolute",margin:"0px"},overlay:{"box-sizing":"border-box","border-color":"transparent","border-style":"solid",color:"transparent",position:"absolute","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden",margin:"0px"},textarea:{background:"transparent"}},a={background:["background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size"],overlay:["font-family","font-size","font-weight","line-height","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width"]},n=function(){function e(t,r){var n=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.overlayPositioner=null,null===t.parentElement)throw new Error("textarea must be in the DOM tree");this.textarea=t,this.textareaStyle=window.getComputedStyle(t),this.backdrop=document.createElement("div"),this.backdrop.className="textoverlay-backdrop",i(this.backdrop,o.backdrop),this.copyTextareaStyle(this.backdrop,a.background),this.textarea.parentElement.insertBefore(this.backdrop,this.textarea),this.overlay=document.createElement("div"),this.overlay.className="textoverlay",i(this.overlay,o.overlay),this.copyTextareaStyle(this.overlay,a.overlay),this.textarea.parentElement.insertBefore(this.overlay,this.textarea),this.syncStyles(),this.textareaStyleWas={},Object.keys(o.textarea).forEach(function(e){n.textareaStyleWas[e]=n.textarea.style.getPropertyValue(e)}),i(this.textarea,o.textarea),this.strategies=r,this.textarea.addEventListener("input",function(){n.handleInput()}),this.textarea.addEventListener("scroll",function(){n.handleScroll()}),this.observer=new MutationObserver(function(){n.syncStyles()}),this.observer.observe(this.textarea,{attributes:!0,attributeFilter:["style"]}),this.resizeListener=function(){n.syncStyles()},window.addEventListener("resize",this.resizeListener),this.render()}return r(e,[{key:"destroy",value:function(){window.removeEventListener("resize",this.resizeListener),this.textarea.removeEventListener("input",this.handleInput),this.textarea.removeEventListener("scroll",this.handleScroll),this.observer.disconnect(),this.overlay.remove(),this.backdrop.remove(),i(this.textarea,this.textareaStyleWas)}},{key:"render",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.updateOverlayNodes(),this.syncStyles()}},{key:"updateOverlayNodes",value:function(){var e=this;this.overlay.innerHTML="",this.overlayPositioner=document.createElement("div"),this.overlayPositioner.className="textoverlay-positioner",this.overlayPositioner.style.display="block",this.overlay.appendChild(this.overlayPositioner),this.computeOverlayNodes().forEach(function(t){e.overlay.appendChild(t)})}},{key:"syncStyles",value:function(){var e=this.textarea.offsetTop,t=this.textarea.offsetLeft,r=this.textarea.offsetHeight,o=this.textarea.clientWidth+parseInt(this.textareaStyle.borderLeftWidth||"0",10)+parseInt(this.textareaStyle.borderRightWidth||"0",10),a=this.textarea.scrollTop,n=null!==this.textareaStyle.zIndex&&"auto"!==this.textareaStyle.zIndex?+this.textareaStyle.zIndex:0;this.backdrop.style.zIndex=""+(n-2),this.overlay.style.zIndex=""+(n-1),this.backdrop.style.left=this.overlay.style.left=t+"px",this.backdrop.style.top=this.overlay.style.top=e+"px",this.backdrop.style.height=this.overlay.style.height=r+"px",this.backdrop.style.width=this.overlay.style.width=o+"px",this.setOverlayScroll(a)}},{key:"setOverlayScroll",value:function(e){null!==this.overlayPositioner&&(this.overlayPositioner.style.marginTop="-"+e+"px")}},{key:"computeOverlayNodes",value:function(){return this.strategies.reduce(function(e,t){var r=document.createElement("span");i(r,t.css);var o=[];return e.forEach(function(e){if(e.nodeType===Node.TEXT_NODE)for(var a=e.textContent||"";;){var n=t.match.lastIndex,i=t.match.exec(a);if(!i){0===n?a&&o.push(e):n<a.length&&o.push(document.createTextNode(a.slice(n)));break}var s=i[0],l=a.slice(n,t.match.lastIndex-s.length);if(l&&o.push(document.createTextNode(l)),s){var c=r.cloneNode(!1);c.textContent=s,o.push(c)}}else o.push(e)}),o},[document.createTextNode(this.textarea.value)])}},{key:"handleInput",value:function(){this.render()}},{key:"handleScroll",value:function(){this.setOverlayScroll(this.textarea.scrollTop)}},{key:"copyTextareaStyle",value:function(e,t){var r=this;t.forEach(function(t){e.style.setProperty(t,r.textareaStyle.getPropertyValue(t))})}}]),e}();function i(e,t){Object.keys(t).forEach(function(r){e.style.setProperty(r,t[r])})}t.default=n}]).default});
//# sourceMappingURL=textoverlay.es5.min.js.map